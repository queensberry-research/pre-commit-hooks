#!/usr/bin/env sh
# shellcheck source=/dev/null

# echo
echo_date() { echo "[$(date +'%Y-%m-%d %H:%M:%S')] $*" >&2; }

# sops
if [ -f "${HOME}/secrets/age/infra.txt" ]; then
	export SOPS_AGE_KEY_FILE="${HOME}/secrets/age/infra.txt"
fi

# uv
export UV_MANAGED_PYTHON='true'
export UV_NATIVE_TLS='true'
export UV_PRERELEASE='disallow'
export UV_PYTHON='3.13'
export UV_RESOLUTION='highest'
export UV_VENV_CLEAR=1
if ! command -v uv >/dev/null 2>&1; then
	echo_date "ERROR: 'uv' not found" && exit 1
fi
activate='.venv/bin/activate'
if [ -f $activate ]; then
	. $activate
else
	uv venv
fi
uv sync --all-extras --all-groups --active --locked

# uv index
export UV_INDEX_NANODE_USERNAME='qrt'
export UV_INDEX_NANODE_PASSWORD='lending0safety0email'
